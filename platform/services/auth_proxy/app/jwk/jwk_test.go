// Copyright (C) 2022-2025 Intel Corporation
// LIMITED EDGE SOFTWARE DISTRIBUTION LICENSE

package jwk

import (
	"encoding/base64"
	"testing"
)

func TestFromPEM(t *testing.T) {
	tests := []struct {
		name        string
		caCrt       string
		expectedJWK JWK
	}{
		{
			name:  "on-prem Test Case",
			caCrt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURxVENDQXdxZ0F3SUJBZ0lSQU5CNFRzM2d6dDlrRkF0Z2RtMTVaUk13Q2dZSUtvWkl6ajBFQXdRd0VqRVEKTUE0R0ExVUVBeE1IWTJFdFkyVnlkREFlRncweU5UQXlNVEF4TXpBeE1UQmFGdzB5TlRBNE1USXdNVEF4TVRCYQpNQUF3Z2dJaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRQzRYcVFubk5ieTN4MHY2S05uCkNIMWwzemxEbHpZS2JoM1RCb21JR3BPWUVjR0M3eEZRWUtKQlUxaE4zb2FDNVNHTkNUdGVubVo0b05HeXc2VHgKQU1KRWpjWlpvMWY5eHRPQ2xiN1c1dk5EODJWOFpaQzZYOUN6VWdmTDRRSnB2UnNZU1FIMU5vYTJHbTVZNTlwcApCVlZ3cEp1bEVETGg4ejg1bWJkWFR6cjJyQndoQnVxTC9vbkZwVzE2aUtWOFU4TVh1NE44SkEzSVc3VHBReVhxClFIelprM2NOZEZldHRXbWthVTExSUtVcUtoKytnQlFneGlFTjdkeFJWTTNZMzBmTEhCYWxWNGtOeFpxeFM4SHgKRlh5OG1HdVlldFZEVDdoWDJXL3V1QjZ1N29iZE1FWkVicEh0L2tUd2xTZGIvWnhucUc2S0V1RFZ0Tm9NOU1sNApjdVNDWDNZaG40Ny9kMVkrYWN4QWUwVExYdy83NE9aaGZUbFl1a24vaXVQdk8vQkNKangzOFZkdzgrSnVSZi9uClJNekNzZkk3N1F1N2diMjB3ZzZjNVdjYkNWZ1RlaEhCbUw4MUY5OE1ZTDRNNTNLQmJ1OEZJRGw3eWFmMUVKUGcKbmd6NXpaWHU4MERZWndCSmdMK09oWnh0TUtKY0QrRG1GdnQzNE8wdWxsL0lkS2VBTkkwUkd5VGc3UWtndWFRawowV0JyYkNNT3pkcFlpUHA5ZVVIa3MxRUJsYmpvSENwaE12QVBuWmdSNWFoWkZMRWhNdGI4TkdxSkR3Q291SlRFCkFXK2xWQVZxRW9mMUYyRGYxcmkxUXVLa3phS0k4MThSR09yOFJHNXYvYlMrd3ZrbndubFc0dnM1b3Q0MjgrQlEKYXFVRGI2TTd0N2poaXBxZ0lkV1NEOHM3QVFJREFRQUJvNEdITUlHRU1BNEdBMVVkRHdFQi93UUVBd0lGb0RBTQpCZ05WSFJNQkFmOEVBakFBTUI4R0ExVWRJd1FZTUJhQUZGWktJclhtS3h1UGcxU1VUc3Q5bmRGWjh6TXNNRU1HCkExVWRFUUVCL3dRNU1EZUNEV2x6ZEdsdkxXZGhkR1YzWVhtQ0ptbHpkR2x2TFdkaGRHVjNZWGt1YVhOMGFXOHQKYzNsemRHVnRMbk4yWXk1amJIVnpkR1Z5TUFvR0NDcUdTTTQ5QkFNRUE0R01BRENCaUFKQ0FTRkJtUkxveFlGRQpUOGFSSFpTZ0dzQTh4Q3lBUzBiVFhtZmhmeXE3NlVLQTcxNXIyTm1NWTJvWDY1UHEyajY1SkphdktVMFBycE85CnAyV0hhclFnMzl4SEFrSUJmUHVRWVJsUXI4S002VEpmazdCeG8vdFRiSEpFK3BMTFpUaEJvSzFXcU9VTUQ5ZXoKb09ZZmJaZmgrZTNONW1Tb0QvV2gzV25hZnQreXZ0RUtmOE1OMWVFPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==",
			expectedJWK: JWK{
				Kid: "755dbc57461cdc95af3fbb68f2b8db0610b0e5a18d9f9e767d1e617b67ab3268634d50594f0a41fbc97c972c3986f52d4ed633fa04396263b484254df2df0c57",
				Use: "sig",
				Kty: "RSA",
				N:   "uF6kJ5zW8t8dL-ijZwh9Zd85Q5c2Cm4d0waJiBqTmBHBgu8RUGCiQVNYTd6GguUhjQk7Xp5meKDRssOk8QDCRI3GWaNX_cbTgpW-1ubzQ_NlfGWQul_Qs1IHy-ECab0bGEkB9TaGthpuWOfaaQVVcKSbpRAy4fM_OZm3V0869qwcIQbqi_6JxaVteoilfFPDF7uDfCQNyFu06UMl6kB82ZN3DXRXrbVppGlNdSClKiofvoAUIMYhDe3cUVTN2N9HyxwWpVeJDcWasUvB8RV8vJhrmHrVQ0-4V9lv7rgeru6G3TBGRG6R7f5E8JUnW_2cZ6huihLg1bTaDPTJeHLkgl92IZ-O_3dWPmnMQHtEy18P--DmYX05WLpJ_4rj7zvwQiY8d_FXcPPibkX_50TMwrHyO-0Lu4G9tMIOnOVnGwlYE3oRwZi_NRffDGC-DOdygW7vBSA5e8mn9RCT4J4M-c2V7vNA2GcASYC_joWcbTCiXA_g5hb7d-DtLpZfyHSngDSNERsk4O0JILmkJNFga2wjDs3aWIj6fXlB5LNRAZW46BwqYTLwD52YEeWoWRSxITLW_DRqiQ8AqLiUxAFvpVQFahKH9Rdg39a4tULipM2iiPNfERjq_ERub_20vsL5J8J5VuL7OaLeNvPgUGqlA2-jO7e44YqaoCHVkg_LOwE",
				E:   "AQAB",
			},
		},
		{
			name:  "cloud Test Case 1",
			caCrt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURxRENDQXdxZ0F3SUJBZ0lRQXFISWI0Q2dMdWlEbWkrWGg4TVhnekFLQmdncWhrak9QUVFEQkRBU01SQXcKRGdZRFZRUURFd2RqWVMxalpYSjBNQjRYRFRJMU1ESXdOVEV3TXpBME5Gb1hEVEkxTURnd05qSXlNekEwTkZvdwpBRENDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFQYURtOXdXSC9DOS9CVkN4K3hyCmdoS2dPVnpOdms3ZVdDYlNkMmE4by9WTEhSTThOTGo1RlZoTndyalFjM3hXNjNxamhLc1d6Z3lQeVR1b3c3eWEKTXg0NFJrdTdGaHhVREtjbGtnRXk4QktITzJHdzRsN1pqeTZacnNCTGVyU1VWUGRSNkY4N2lqcWxMcUNidVBtNgpXTDR0bTloTm9qdzZHek8rcE81VjRPM1Z2VUJNd2pueEFGek5IcnAyZEw2d1VvRnlGZHY3aHBDL29Gd284dTBrClZ5akhsMjIwN0l3RXJESHpFeU93S1pFbEZWNFQyMGJuQWZQazZrcllzN0ZXWjdYb1lrYytRd2lYcFNUVng5TUIKRkdBbG95QnRRYnJzU0I1QkJJUEJzMFc1NmJlbXJOaW1pZEF6Z0lxTUNkd29EczBTMzJKQ1U5dHhBMzFEa3A5MApJMDV0UlUzOU9mMDk3bnFQdjRNUDIraU1zMlh2VUVnOG9FcEFCZ3NWUy8xa29YOGtpcG5EWkpWRjFUa3dVK040CnNkdnRyS0l6Vkxzamk3U0JpeU16VVV5ak0xZ051RVcyUGdYVzlvK29EeEdhd2UzZE9Obkp6T1J5R3NqaGRyRE8KcmlGR1luVTBPdHpGb2gyajdWZDhub3N0RDZ0Rk8zVzRBRFluZDM4ZkVtOEVsVWlMQkhmRFkyV3NUdGV4cE9qbgpSZW13K0hSSW5VcWdSL2lSc3NEMW1aSWFLa1JHYVJZTjdKcHZKWlo2OC83cTU1TkNJZlZVdXVvY25qd3V1RXQ0ClRENUNFcEFib1FwMVZsR2ZSNWxoSlBZb3FDZWh0OEJQRklzTWl6RWxoTEkvbml2dE91OEdERmREZklBdlhGZDYKaS9OQnAzRCtDUW1KcVFBeGhBL1hVaGgvQWdNQkFBR2pnWWd3Z1lVd0RnWURWUjBQQVFIL0JBUURBZ1dnTUF3RwpBMVVkRXdFQi93UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVTEvTUlmMk5TVGNNNC8yMDNzT3hFTW9QWVJnSXdSQVlEClZSMFJBUUgvQkRvd09JSU5hWE4wYVc4dFoyRjBaWGRoZVlJbmFYTjBhVzh0WjJGMFpYZGhlUzVwYzNScGJ5MXAKYm1keVpYTnpMbk4yWXk1amJIVnpkR1Z5TUFvR0NDcUdTTTQ5QkFNRUE0R0xBRENCaHdKQldob0Jyd1VtdytYTQplTGVaanVzdjdVSElZUjlycEdKQUFGNFpMT3NJQWk4bk1YQWVtZ2twTVFPNnc0d25OS1NhajFONmdYRDFRdFVJClRwYlpocFEwK244Q1FnRjdBckhxQTY2VTNpUjI1MEh6TTJ3NGNtR0s5RWVJbG1Rcmdmd3Z2c2RwOU9ZMHVZckgKZFQ3NTVpa2JrWDVpbVhRalY1NWZjaDdXYmtHME14dzlkZFlSTEE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==",
			expectedJWK: JWK{
				Kid: "d173365729cc916a853470260240af9f99f6d802629bfcbf2430519d44b25bf37877f33d19b1e36dd9345ba1ccc090699514b77cae9c101c124b35cec1681d86",
				Use: "sig",
				Kty: "RSA",
				N:   "9oOb3BYf8L38FULH7GuCEqA5XM2-Tt5YJtJ3Zryj9UsdEzw0uPkVWE3CuNBzfFbreqOEqxbODI_JO6jDvJozHjhGS7sWHFQMpyWSATLwEoc7YbDiXtmPLpmuwEt6tJRU91HoXzuKOqUuoJu4-bpYvi2b2E2iPDobM76k7lXg7dW9QEzCOfEAXM0eunZ0vrBSgXIV2_uGkL-gXCjy7SRXKMeXbbTsjASsMfMTI7ApkSUVXhPbRucB8-TqStizsVZntehiRz5DCJelJNXH0wEUYCWjIG1BuuxIHkEEg8GzRbnpt6as2KaJ0DOAiowJ3CgOzRLfYkJT23EDfUOSn3QjTm1FTf05_T3ueo-_gw_b6IyzZe9QSDygSkAGCxVL_WShfySKmcNklUXVOTBT43ix2-2sojNUuyOLtIGLIzNRTKMzWA24RbY-Bdb2j6gPEZrB7d042cnM5HIayOF2sM6uIUZidTQ63MWiHaPtV3yeiy0Pq0U7dbgANid3fx8SbwSVSIsEd8NjZaxO17Gk6OdF6bD4dEidSqBH-JGywPWZkhoqREZpFg3smm8llnrz_urnk0Ih9VS66hyePC64S3hMPkISkBuhCnVWUZ9HmWEk9iioJ6G3wE8UiwyLMSWEsj-eK-067wYMV0N8gC9cV3qL80GncP4JCYmpADGED9dSGH8",
				E:   "AQAB",
			},
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			certBytes, _ := base64.StdEncoding.DecodeString(tt.caCrt)

			jwk, err := FromPEM(certBytes)
			if err != nil {
				t.Fatalf("Failed to convert PEM to JWK: %v", err)
			}

			if !jwk.Equal(tt.expectedJWK) {
				t.Errorf("FromPEM() = %v, want %v", jwk, tt.expectedJWK)
			}
		})
	}
}
